# Инструкция по сборке Rimskiy Service

## Сборка релизной версии для Windows

### Быстрая сборка

#### Вариант 1: Использование готового скрипта (рекомендуется)

```bash
# Запустите один из скриптов:
build-release.bat    # для cmd
# или
.\build-release.ps1  # для PowerShell
```

Скрипт автоматически:
1. Очистит предыдущие сборки
2. Соберёт релизную версию
3. Создаст папку `release` со всеми необходимыми файлами

#### Вариант 2: Ручная сборка

```bash
# 1. Очистка предыдущих сборок
cargo clean

# 2. Сборка релизной версии
cargo build --release

# 3. Исполняемый файл будет находиться в:
# target\release\Rimskiy_service.exe
```

## Структура релизной папки

После сборки в папке `release` будут находиться:

```
release/
├── Rimskiy_service.exe    # Исполняемый файл сервера
├── .env.example           # Пример конфигурации
├── README.md              # Документация
└── migrations/            # SQL миграции
    ├── 20241117000001_init.sql
    ├── 20241118000001_add_user_plates.sql
    └── ...
```

## Развёртывание на сервере

### Шаг 1: Копирование файлов

Скопируйте всю папку `release` на сервер Windows.

### Шаг 2: Настройка конфигурации

1. Переименуйте `.env.example` в `.env`
2. Отредактируйте `.env` и укажите:
   - `DATABASE_URL` - подключение к PostgreSQL
   - `JWT_SECRET` - секретный ключ (минимум 32 символа)
   - `ENCRYPTION_KEY` - ключ шифрования (64 hex символа)
   - Остальные параметры по необходимости

### Шаг 3: Запуск сервера

Просто запустите `Rimskiy_service.exe`:

```bash
.\Rimskiy_service.exe
```

Сервер автоматически:
- Создаст базу данных, если её нет
- Применит все миграции
- Запустится на указанном порту (по умолчанию 3000)

## Требования

- Windows 10/11 или Windows Server 2016+
- PostgreSQL должен быть установлен и доступен
- Visual C++ Redistributable (если используется native TLS)

## Оптимизация размера

Если нужно уменьшить размер .exe файла, можно добавить в `Cargo.toml`:

```toml
[profile.release]
opt-level = "z"      # Оптимизация по размеру
lto = true          # Link-time optimization
strip = true        # Удаление отладочной информации
```

## Создание portable версии

Для создания полностью portable версии (с PostgreSQL embedded) потребуется дополнительная настройка. Текущая версия требует установленного PostgreSQL на сервере.

